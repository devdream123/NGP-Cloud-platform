---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "mesh.fullname" . }}-meshrc-cm
data:
  .meshrc.yaml: |-
    ---
    serve:
        cors:
          origin: '{{ .Values.mesh.cors.origin }}'
        hostname: 0.0.0.0
        port: {{ .Values.service.port }}

    sources:
      - name: Deal Sheet
        handler:
          graphql:
            endpoint: http://{{ .Values.dealSheet.hostname }}:{{ .Values.dealSheet.port }}/graphql/
      - name: Calendar
        handler:
          graphql:
            endpoint: http://{{ .Values.calendar.hostname }}:{{ .Values.calendar.port }}/graphql/
      - name: Hierarchy
        handler:
          openapi:
            source: https://raw.githubusercontent.com/typesense/typesense-api-spec/master/openapi.yml
            baseUrl: http://{{ .Values.hierarchy.hostname }}:{{ .Values.hierarchy.port }}/
            operationHeaders:
              X-TYPESENSE-API-KEY: f44910b7-4b35-48bb-ac16-4f6a4d5af120
