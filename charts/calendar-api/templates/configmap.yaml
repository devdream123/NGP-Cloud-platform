apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "calendar-api.fullname" . }}-cm
  labels:
    {{- include "calendar-api.labels" . | nindent 4 }}
data:
  GCPSettings__AppVersion: {{ .Values.appVersion | quote }}
  GCPSettings__ProjectId: {{ .Values.projectId | quote }}
  GCPSettings__RequestTracingRate: {{ .Values.requestTracingRate | quote }}
  Hierarchy__Url: {{ printf "http://%s.%s.svc.cluster.local" .Values.hierarchyChartName .Values.backendNamespace | quote  }}
  DemandDriver__ForecastUrl: {{ printf "http://%s.%s.svc.cluster.local/graphql" .Values.forecastChartName .Values.analyticsNamespace | quote  }}
  GraphQLClient__DealsheetUrl: {{ printf "http://%s.%s.svc.cluster.local/graphql" .Values.dealsheetChartName .Values.backendNamespace | quote  }}
  GraphQLClient__EventScheduleUrl: {{ printf "http://%s.%s.svc.cluster.local/graphql" .Values.eventScheduleChartName .Values.backendNamespace | quote  }}
  ServiceSettings__Calendar__FirestoreSettings__RootCollectionName: {{ .Values.firestore.calendarCollection | quote }}
  ServiceSettings__Calendar__FirestoreSettings__MaximumQueries: {{ .Values.firestore.calendarSettings.maximumQueries | quote }}
  ServiceSettings__Calendar__FirestoreSettings__MaximumBatchSize: {{ .Values.firestore.calendarSettings.maximumBatchSize | quote }}
  ServiceSettings__Calendar__FirestoreSettings__MinimumBatchSize: {{ .Values.firestore.calendarSettings.minimumBatchSize | quote }}
  ServiceSettings__Calendar__FirestoreSettings__MaximumDegreeOfParallelism: {{ .Values.firestore.calendarSettings.maximumDegreeOfParallelism | quote }}
  ServiceSettings__Dealsheet__FirestoreSettings__RootCollectionName: {{ .Values.firestore.dealsheetCollection | quote }}
  ServiceSettings__Dealsheet__FirestoreSettings__MaximumQueries: {{ .Values.firestore.dealsheetSettings.maximumQueries | quote }}
  ServiceSettings__Dealsheet__FirestoreSettings__MaximumBatchSize: {{ .Values.firestore.dealsheetSettings.maximumBatchSize | quote }}
  ServiceSettings__Dealsheet__FirestoreSettings__MinimumBatchSize: {{ .Values.firestore.dealsheetSettings.minimumBatchSize | quote }}
  ServiceSettings__Dealsheet__FirestoreSettings__MaximumDegreeOfParallelism: {{ .Values.firestore.dealsheetSettings.maximumDegreeOfParallelism | quote }}
  ServiceSettings__Scenario__FirestoreSettings__RootCollectionName: {{ .Values.firestore.scenariosCollection | quote }}
  ServiceSettings__Placeholder__FirestoreSettings__RootCollectionName: {{ .Values.firestore.placeholdersCollection | quote }}
  SystemTimeZone: {{ .Values.systemTimeZone | quote }}
  ASPNETCORE_URLS: {{ printf "http://%s.%s.svc.cluster.local:%v" .Release.Name .Release.Namespace .Values.service.port | quote }}
  CORECLR_ENABLE_PROFILING: "1"
  CORECLR_PROFILER: "{918728DD-259F-4A6A-AC2B-B85E1B658318}"
  CORECLR_PROFILER_PATH: "/root/.splunk-otel-dotnet/linux-x64/OpenTelemetry.AutoInstrumentation.Native.so"
  DOTNET_ADDITIONAL_DEPS: "/root/.splunk-otel-dotnet/AdditionalDeps"
  DOTNET_SHARED_STORE: "/root/.splunk-otel-dotnet/store"
  DOTNET_STARTUP_HOOKS: "/root/.splunk-otel-dotnet/net/OpenTelemetry.AutoInstrumentation.StartupHook.dll"
  {{- if .Values.otel.enabled }}
  OTEL_DOTNET_AUTO_PLUGINS: "Splunk.OpenTelemetry.AutoInstrumentation.Plugin, Splunk.OpenTelemetry.AutoInstrumentation"
  OTEL_DOTNET_AUTO_HOME: "/root/.splunk-otel-dotnet"
  OTEL_DOTNET_AUTO_INTEGRATIONS_FILE: "/root/.splunk-otel-dotnet/integrations.json"
  OTEL_SERVICE_NAME: {{ .Values.otel.serviceName | quote }}
  OTEL_RESOURCE_ATTRIBUTES: {{ .Values.otel.resourceAttributes | quote }}
  OTEL_TRACES_EXPORTER: {{ .Values.otel.tracesExporter | quote }}
  OTEL_TRACES_SAMPLER: {{ .Values.otel.tracesSampler | quote }}
  OTEL_PROPAGATORS: {{ .Values.otel.propagators | quote }}
  OTEL_LOG_LEVEL: {{ .Values.otel.logLevel | quote }}
  {{- end }}
