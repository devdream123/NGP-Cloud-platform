---
steps:
  - name: 'us-central1-docker.pkg.dev/gcp-wow-corp-infra-qrtl-prod/hub-prd-us1-shared-asset-registry1/helmfile'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        if [[ "$BRANCH_NAME" == 'main' ]]; then 
          bash ./scripts/substitute-charts-secrets.sh 
        fi
        if [[ "$BRANCH_NAME" == 'tst' ]]; then 
          bash ./scripts/substitute-charts-secrets.sh tst
        fi
        script_exit_code=$?
        exit $script_exit_code
    secretEnv:
      - 'TYPESENSE_API_KEY'
      - 'FORECAST_POSTGRES_PWD_DEV'
      - 'FORECAST_POSTGRES_PWD_UAT'
      - 'FORECAST_POSTGRES_PWD_PRD'
      - 'FORECAST_POSTGRES_PWD_TST'
      - 'REACT_APP_ERROR_REPORTING_API_KEY_TST'
      - 'REACT_APP_LAUNCHDARKLY_CLIENT_ID_TST'
      - 'REACT_APP_ERROR_REPORTING_API_KEY_DEV'
      - 'REACT_APP_LAUNCHDARKLY_CLIENT_ID_DEV'
      - 'REACT_APP_ERROR_REPORTING_API_KEY_UAT'
      - 'REACT_APP_LAUNCHDARKLY_CLIENT_ID_UAT'
      - 'REACT_APP_ERROR_REPORTING_API_KEY_PRD'
      - 'REACT_APP_LAUNCHDARKLY_CLIENT_ID_PRD'
  - name: 'us-central1-docker.pkg.dev/gcp-wow-corp-infra-qrtl-prod/hub-prd-us1-shared-asset-registry1/helmfile'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        if [[ "$BRANCH_NAME" == 'main' ]]; then 
          ./scripts/helm-template-check.sh 
        fi
        if [[ "$BRANCH_NAME" == 'tst' ]]; then 
          ./scripts/helm-template-check.sh tst
        fi
        script_exit_code=$?
        exit $script_exit_code
  - name: 'us-central1-docker.pkg.dev/gcp-wow-corp-infra-qrtl-prod/hub-prd-us1-shared-asset-registry1/helmfile'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        if [[ "$BRANCH_NAME" == 'main' ]]; then 
          ./scripts/deploy.sh 
        fi
        if [[ "$BRANCH_NAME" == 'tst' ]]; then 
          ./scripts/deploy.sh tst
        fi
options:
  logging: CLOUD_LOGGING_ONLY
availableSecrets:
  secretManager:
    - versionName: projects/$PROJECT_ID/secrets/ngp-ci-us1-typesense-hierarchy-api-key1-sms/versions/1
      env: TYPESENSE_API_KEY
    - versionName: projects/$PROJECT_ID/secrets/ngp-dev-us1-forecast-postgres-pwd1-sms/versions/1
      env: 'FORECAST_POSTGRES_PWD_DEV'
    - versionName: projects/$PROJECT_ID/secrets/ngp-uat-us1-forecast-postgres-pwd1-sms/versions/1
      env: 'FORECAST_POSTGRES_PWD_UAT'
    - versionName: projects/$PROJECT_ID/secrets/ngp-prd-us1-forecast-postgres-pwd1-sms/versions/1
      env: 'FORECAST_POSTGRES_PWD_PRD'
    - versionName: projects/$PROJECT_ID/secrets/ngp-tst-us1-forecast-postgres-pwd1-sms/versions/1
      env: 'FORECAST_POSTGRES_PWD_TST'
    - versionName: projects/$PROJECT_ID/secrets/ngp-tst-us1-stackdriver-reporting-api-key1-sms/versions/1
      env: 'REACT_APP_ERROR_REPORTING_API_KEY_TST'
    - versionName: projects/$PROJECT_ID/secrets/ngp-tst-us1-launch-darkly-client-id-key1-sms/versions/1
      env: 'REACT_APP_LAUNCHDARKLY_CLIENT_ID_TST'
    - versionName: projects/$PROJECT_ID/secrets/ngp-dev-us1-stackdriver-reporting-api-key1-sms/versions/1
      env: 'REACT_APP_ERROR_REPORTING_API_KEY_DEV'
    - versionName: projects/$PROJECT_ID/secrets/ngp-dev-us1-launch-darkly-client-id-key1-sms/versions/1
      env: 'REACT_APP_LAUNCHDARKLY_CLIENT_ID_DEV'
    - versionName: projects/$PROJECT_ID/secrets/ngp-uat-us1-stackdriver-reporting-api-key1-sms/versions/1
      env: 'REACT_APP_ERROR_REPORTING_API_KEY_UAT'
    - versionName: projects/$PROJECT_ID/secrets/ngp-uat-us1-launch-darkly-client-id-key1-sms/versions/1
      env: 'REACT_APP_LAUNCHDARKLY_CLIENT_ID_UAT'
    - versionName: projects/$PROJECT_ID/secrets/ngp-prd-us1-stackdriver-reporting-api-key1-sms/versions/1
      env: 'REACT_APP_ERROR_REPORTING_API_KEY_PRD'
    - versionName: projects/$PROJECT_ID/secrets/ngp-prd-us1-launch-darkly-client-id-key1-sms/versions/1
      env: 'REACT_APP_LAUNCHDARKLY_CLIENT_ID_PRD'