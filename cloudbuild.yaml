---
steps:
  - name: 'us-central1-docker.pkg.dev/gcp-wow-corp-infra-qrtl-prod/hub-prd-us1-shared-asset-registry1/helmfile'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        if [[ "$BRANCH_NAME" == 'main' ]]; then 
          ./scripts/deploy.sh 
        fi
    secretEnv:
      - 'FORECAST_POSTGRES_PWD_DEV'
      - 'FORECAST_POSTGRES_PWD_UAT'
      - 'FORECAST_POSTGRES_PWD_PRD'
      - 'FORECAST_POSTGRES_PWD_TST'
options:
  logging: CLOUD_LOGGING_ONLY
availableSecrets:
  secretManager:
    - versionName: projects/$PROJECT_ID/secrets/ngp-dev-us1-forecast-postgres-pwd1-sms/versions/1
      env: 'FORECAST_POSTGRES_PWD_DEV'
    - versionName: projects/$PROJECT_ID/secrets/ngp-uat-us1-forecast-postgres-pwd1-sms/versions/1
      env: 'FORECAST_POSTGRES_PWD_UAT'
    - versionName: projects/$PROJECT_ID/secrets/ngp-prd-us1-forecast-postgres-pwd1-sms/versions/1
      env: 'FORECAST_POSTGRES_PWD_PRD'
    - versionName: projects/$PROJECT_ID/secrets/ngp-tst-us1-forecast-postgres-pwd1-sms/versions/1
      env: 'FORECAST_POSTGRES_PWD_TST'